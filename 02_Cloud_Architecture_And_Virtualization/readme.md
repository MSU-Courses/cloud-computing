# Архитектура облачных систем и основы виртуализации

<i>
Следующим вечером Джон и Эмма сидели в пустой университетской компьютерной лаборатории. Лампы за окнами отбрасывали длинные тени по стенам, и сервер в углу мерно гудел, словно большое спящее животное. Эмма устало потянулась: сегодня они вдвоём пытались запускать на старом сервере сразу несколько проектов, и очередь из задач росла, как тени в комнате. Джон задумчиво барабанил пальцами по столу.

— Представь, — тихо сказал он, — если бы этот одинокий сервер мог раздвоиться… или даже разделиться на десяток маленьких серверов. Каждый занялся бы своей задачей — и нам не пришлось бы ждать.

Эмма усмехнулась: — Разделиться? Как клетка под микроскопом?

Джон пожал плечами: — Почему нет? Будто фокусник достаёт из шляпы бесконечный поток кроликов. Был бы один компьютер, а мы из него — бац! — сделали много. Каждому студенту — по «фантомному» компьютеру…

Он замолчал, представив эту картину. В полумраке лаборатории ему почудилось, что сервер улыбнулся огоньками индикаторов, словно услышав их. Эмма покачала головой, но в глубине души тоже ощутила странное волнение, будто в воздухе пахнет чудом. За окном медленно плыл ночной туман, и Джону привиделось, будто это сами облака опустились послушать их разговор…

Этой ночью ребята ещё не знали, что вскоре на лекции им раскроется секрет такого «волшебства» — технология, позволяющая одному физическому компьютеру превратиться в множество виртуальных. Но пока Джон и Эмма просто сидели рядом в тишине лаборатории, да мечтали о чудесах, которые творятся в облаках...
</i>

## Вопросы для самопроверки

После изучения этой главы вы сможете ответить на следующие вопросы:

1. Чем физическая архитектура облака отличается от виртуальной модели облачной архитектуры?
   2, Что такое виртуализация и какие виды виртуализации (например, full и para) используются в облачных системах?
2. В чём смысл принципов resource pooling и multi-tenancy и как они обеспечивают работу облака?
3. Что такое контейнер и чем он отличается от виртуальной машины? Какую роль играют образы контейнеров?
4. Какие существуют модели облачных сервисов (IaaS, PaaS, SaaS) и что подразумевается под концепцией XaaS ("всё как услуга")?

## Архитектура облачных систем: физическая vs виртуальная модель

Архитектуру облачных систем можно рассматривать с двух точек зрения: физической и виртуальной.

_Физическая архитектура_ — это реальные датацентры с серверами, дисковыми хранилищами и сетевым оборудованием, разбросанные по миру. Эти физические ресурсы составляют основу облака: тысячи серверов, подключённые через высокоскоростные сети, снабжённые системой питания и охлаждения. Однако, обычному пользователю облака вся эта физическая инфраструктура невидима.

Пользователь взаимодействует с _виртуальной моделью_ облачной архитектуры. Это означает, что пользователи взаимодействуют не с конкретным физическим сервером, а с абстракцией — виртуальными ресурсами. Например, когда вы запускаете сервер в облачном сервисе, на самом деле он может работать на любом из множества физически существующих серверов, но для вас он выглядит как отдельная машина, которую вы можете настроить и использовать по своему усмотрению. Проще говоря, облако — это совокупность виртуализованных вычислительных мощностей, хранилищ и сетей, которыми управляет специальное ПО. Такой набор ресурсов часто называют *«пулом»* (от англ. pool - «пруд», «бассейн»), Пользователь запрашивает, например, сервер или хранилище через веб-интерфейс — а облако автоматически находит свободные ресурсы в своих датацентрах и “создаёт” для пользователя запрошенный виртуальный ресурс.

В виртуальной модели архитектуры ключевую роль играет слой виртуализации (о нём подробно поговорим далее). Именно он обеспечивает изоляцию и абстракцию: физические особенности серверов скрыты от пользователя — вместо этого пользователь видит только виртуальные характеристики (количество виртуальных процессоров, объём памяти, размер диска и т.д.). Такая архитектура даёт огромный выигрыш в гибкости. Например, если физический сервер выходит из строя, облако может автоматически “переключить” его виртуальные машины на другие серверы, и пользователь даже не заметит сбоя. Кроме того, виртуальная архитектура позволяет масштабировать ресурсы по запросу: если приложению вдруг нужно больше мощности, облако просто выделит дополнительные виртуальные ресурсы из пула.

Итак, *физическая архитектура облака* – это про «железо» (hardware): реальные машины, кабели, диски. *Виртуальная архитектура* – про «иллюзию» (software-defined): программное представление этих ресурсов, которое получает пользователь. Переход от физического к виртуальному – основа облачных технологий, потому что без этого облако не смогло бы быть эластичным и управляемым.

## Виртуализация: понятие и роль в облаке

*Виртуализация* — это технология, позволяющая создавать абстрактные (виртуальные) версии вычислительных ресурсов, отделяя их от физической основы.  В облачных системах она означает, что реальные серверы, хранилища и сети преобразуются с помощью программных средств в логические ресурсы, которыми можно гибко и эффективно управлять. Иными словами, виртуализация скрывает аппаратную часть за программным слоем: пользователь работает с виртуальными машинами и дисками, не задумываясь о том, какие конкретные процессоры или накопители используются в дата-центре.

Если без виртуализации на одном физическом сервере обычно работает только одна операционная система и приложение, то с помощью виртуализации этот один сервер можно “разрезать” на несколько *виртуальных машин* (Virtual Machines, VM) – каждая со своей ОС, своим окружением. Каждая виртуальная машина "верит", что она — полноценный компьютер, хотя в реальности они все разделяют ресурсы одного физического сервера.

Виртуализация обеспечивает несколько ключевых преимуществ для облачных систем:

- _Эффективное использование ресурсов_. Вместо того чтобы выделять отдельный сервер под каждое приложение, которое будет использовать ресурсы не полностью, виртуализация позволяет запускать несколько виртуальных машин, которые изолируются на одном физическом сервере, максимально используя его мощность.
- _Изоляция и безопасность_. Каждая виртуальная машина изолирована. Если на одной происходит сбой или атака, это не влияет на другие. Изоляцию обеспечивает специальное программное обеспечение — гипервизор. Это как жить в многоквартирном доме: у каждого жильца своя квартира, и проблемы одного не затрагивают другого (при условии хорошей звукоизоляции и безопасности дверей).
- _Гибкость и масштабируемость_. Виртуальные ресурсы можно быстро создать, удалить, скопировать или перенести с одного физического сервера на другой, допустим если тот выходит из строя - всё это делается программно, без необходимости физического вмешательства. А если приложению нужно больше ресурсов, облако может просто выделить дополнительные ресурсы для виртуальной машины.
- _Удобство управления_. Автоматизация управления виртуальными ресурсами намного проще: администраторы пишут скрипты, которые развертывают десятки виртуальных машин по шаблону, следят за их состоянием, переносят их между узлами. Облако, наполненное виртуальными машинами, можно администрировать централизованно, не бегая к каждому серверу с отверткой.

Таким образом, виртуализация – фундаментальный кирпичик облачной модели. Недаром говорят: “облако без виртуализации – не облако, а просто аренда железа”. В классическом определении, *облако* – это инфраструктура, где мощности абстрагированы и виртуализированы, масштабируются динамически и предоставляются множеству потребителей по запросу [^1].
 
## Гипервизор и виртуальные машины

Основной инструмент виртуализации – *гипервизор* (англ. *hypervisor*). Это программный слой, который устанавливается на физический сервер или на операционную систему и берёт на себя роль управляющего ресурса: он создаёт, запускает и управляет виртуальными машинами. Он распределяет физическую память, CPU, доступ к диску между несколькими виртуальными машинами и следит, чтобы они друг другу не мешали [^1]. По сути, гипервизор – как диспетчер, решающий, какой виртуальной машине дать кусочек процессорного времени в следующий момент или сколько памяти отдать.

Существует *два типа гипервизоров*:

- _Type 1. Bare-Metal_ (ru. "голое железо"). Устанавливается прямо на аппаратное обеспечение сервера, без промежуточной ОС. Такой гипервизор работает максимально эффективно, так как имеет прямой доступ к ресурсам железа. Примеры: VMware ESXi, Microsoft Hyper-V, Xen.
- _Type 2. Hosted_. Запускается как приложение поверх обычной операционной системы. Например, VirtualBox или VMware Workstation, которые вы можете поставить на свой ноутбук. Они удобны для разработки и учебных целей, но в датацентрах используются реже из-за некоторого снижения производительности (ведь сверху ещё работает хост-ОС).

Каждая виртуальная машина работает как отдельный компьютер на *операционной системе физического компьютера* (_Host OS_) и имеет:

- Собственную операционную систему, которая называется _гостевой ОС_ (*guest OS*). Это может быть Linux, Windows, или любая другая ОС.
- Свои виртуальные устройства: виртуальные процессоры, память, сетевые адаптеры, диски, которые эмулируются гипервизором.

Гостевая ОС не замечает подвоха и считает, что у неё свой собственный процессор и память. В этом и состоит *full virtualization (полная виртуализация)* – гипервизор предоставляет гостю полностью эмулированное аппаратное окружение, и гость даже не подозревает, что на самом деле разделяет ресурсы с другими ВМ. В полной виртуализации гипервизор выполняет “перевод” команд гостевой ОС в команды к физическому железу.

![Рисунок 1. Типы гипервизоров](../_images/02/01_hypervisor_type.webp)

_Рисунок 1. Типы гипервизоров_

## Resource Pooling и Multi-Tenancy

Облачные провайдеры стремятся максимально эффективно задействовать своё «железо» и одновременно обслуживать много клиентов. Именно для этого служит концепция *resource pooling* (объединение ресурсов) и *multi-tenancy* (многопользовательскость, букв. «многоарендность»). Данные принципы были рассмотрены в предыдущей главе, 

*Resource Pooling* означает, что все физические ресурсы объединяются провайдером в единый пул, из которого динамически выделяются виртуальные ресурсы по запросам пользователей. Пользователю не важно (и зачастую неизвестно), на каком именно сервере крутится его виртуальная машина – важно, что облако даёт необходимую мощность. Такое объединение даёт эффект “*большого котла*”: из него можно черпать столько ресурсов, сколько нужно, не заботясь о конкретной печке, в которой горят угли.

*Multi-tenancy (мультиарендность)* - это модель, при которой одним и тем же набором физического оборудования и приложений могут одновременно пользоваться несколько независимых потребителей (тенантов, от англ. tenant – арендатор). Каждый клиент облака как бы “снимает квартиру” в большом доме: он получает свой виртуальный участок ресурсов, изолированный от других, но физически эти ресурсы могут находиться на тех же серверах. *Мультиарендность делает облако экономически выгодным и масштабным*. Провайдер, обслуживая сотни клиентов на единой платформе, достигает эффекта масштаба: большое совместное облако проще поддерживать, дешевле в расчёте на одного пользователя, чем сотни отдельных маленьких инфраструктур. При этом каждый потребитель ощущает себя единственным: его данные и программы изолированы программно (через механизмы виртуализации, настройки доступа и т.д.).


## Виртуализация сети (SDN) и хранилищ

Виртуализация в облаках распространяется не только на вычислительные машины, но и на *сети* и *хранилища данных*. Чтобы облачная архитектура была полной, нужно абстрагировать и эти компоненты, сделав их гибкими, программно управляемыми.

### Виртуализация сети и Software-Defined Networking

*Виртуализация сети* – это подход, при котором сеть (или несколько сетей) представляются в виде программно управляемых логических объектов, независимо от физической топологии. По сути, так же как гипервизор делит сервер на виртуальные машины, сеть можно *“разделить” на несколько виртуальных сетей* или, наоборот, *объединить географически разнесённые узлы* в одну виртуальную сеть поверх интернета. Несколько виртуальных сетей могут сосуществовать на одном физическом сетевом оборудовании, не влияя друг на друга.

Простейшие примеры сетевой виртуализации известны давно: VLAN (Virtual LAN) - виртуальные локальные сети, которые позволяют логически сегментировать сеть на уровне коммутаторов и VPN (Virtual Private Network) - защищённые каналы поверх общедоступных сетей. Эти технологии позволяют несколько разных сетевых сообществ пользоваться одной физической инфраструктурой, но логически быть отделёнными.

В облачных системах используется более продвинутый подход – *Software-Defined Networking (SDN)*. Это концепция, при которой управление сетью отделено от физического оборудования и реализуется программно. В SDN центральный контроллер программно управляет поведением всей сети: маршрутизацией, политиками безопасности, качеством обслуживания. Администраторы могут динамически создавать, изменять и удалять виртуальные сети, настраивать правила трафика и обеспечивать изоляцию между клиентами облака.

SDN разделяет сеть на два основных слоя:

- _Control Plane_ (плоскость управления) – отвечает за принятие решений о маршрутизации и политике. В SDN этот слой централизован и реализуется контроллером.
- _Data Plane_ (плоскость данных) – отвечает за фактическую передачу пакетов. Это физические устройства (коммутаторы, маршрутизаторы), которые выполняют указания контроллера.

В обычной сети каждый маршрутизатор имеет и *control plane*, и *data plane* внутри себя: он сам принимает решения и сам же пересылает пакеты. В SDN же делается хитрость: плоскость управления выносят в отдельный централизованный компонент – контроллер. А коммутаторы и маршрутизаторы становятся “глупыми” устройствами, которые просто выполняют команды контроллера. Это позволяет программно управлять всей сетью из одного места, быстро адаптироваться к изменениям и создавать сложные сетевые топологии по запросу.

![Рисунок 2. Архитектура SDN](../_images/02/02_sdn_network_virtualization.png)

_Рисунок 2. Архитектура SDN_

Это дает *гибкость и программируемость*. Администратор, имея SDN-контроллер, может программно задать правила для всей сети сразу (“на весь этот сегмент ограничить полосу до 100 Мбит/с для видео” или “все пакеты от IP X направлять через шлюз Y”). Контроллер сам распространит эти правила на оборудование. Можно динамически перенастраивать маршруты, балансировать нагрузку, включать сложные политики — и всё программно из одного места. В больших облачных датацентрах SDN позволяет эффективно управлять тысячами сетевых устройств как единым целым [^3].

В контексте облака SDN помогает *легко создавать и управлять виртуальными сетями*. Например, когда вы в облаке определяете сетевые политики (маршруты, ACL, балансировку нагрузки), под капотом SDN-контроллеры конфигурируют все задействованные узлы. Также SDN тесно связан с понятием NFV (*Network Functions Virtualization*) – переноса сетевых функций (маршрутизаторов, файрволов, балансировщиков) на программные модули, часто запускаемые на обычных серверах. Вместо дорогого сетевого “железа” провайдер использует виртуальные сетевые функции, которые можно запускать как сервисы в облаке.

Приведём простую аналогию: традиционная сеть – это город, где каждый светофор сам по себе настроен и переключается, глядя только на свою перекрёсток. SDN – это как если бы появился центральный пульт управления всеми светофорами города, куда стекается информация о пробках по всем улицам, и который может в реальном времени перенастраивать режимы светофоров по всему городу, оптимизируя трафик сразу глобально. 

Главное понимать, что *виртуализация сети в облаке означает, что вы можете получать сетевые ресурсы (“виртуальные маршрутизаторы”, “подсети”, “брандмауэры”) так же, как получаете виртуальные серверы*. А SDN – это технология, которая делает сети гибкими и управляемыми программно, что идеально сочетается с идеологией облака. С помощью SDN облачные провайдеры добиваются высокой автоматизации сети, изолированности клиентов друг от друга на уровне трафика и возможности быстро строить сложные сетевые топологии по запросу.

### Виртуализация хранилищ

*Виртуализация хранения* (_Storage Virtualization_) означает, что физические устройства хранения (жесткие диски, SSD, ленточные библиотеки и т.д.) объединяются в единый логический пул, из которого пользователям предоставляются виртуальные тома, хранилища или файлы. Пользователь видит как бы одно большое хранилище или нужное количество дискового пространства, не зная, на скольких и каких именно физических дисках лежат его данные. То есть возможно такое, что один виртуальный диск пользователя физически распределён по нескольким серверам и дискам в датацентре.

Облачный сервис хранения данных может состоять из десятков дисковых шкафов, но вам он выдаёт один виртуальный диск на 100 ГБ. Где именно на этих шкафах будут лежать ваши блоки – решает система, она же может переставлять данные, дублировать их для отказоустойчивости и т.д., а вы этого не видите. *Storage virtualization* скрывает от пользователя сложность подсистемы хранения, предоставляя ему простой интерфейс: хранилище определённого объёма, с определённой скоростью ввода-вывода.

Для достижения виртуализации хранения используются разные технологии:

- *SAN (Storage Area Network)* и *NAS (Network Attached Storage)*. Это сетевые технологии, которые позволяют объединять дисковые устройства в общую сеть хранения. SAN работает на уровне блоков (как локальный диск), а NAS – на уровне файлов (как файловый сервер).
- _RAID-массивы и распределённые файловые системы_. Они позволяют объединять несколько физических дисков в один логический том, обеспечивая избыточность и производительность.
- _Программно-определяемое хранилище (SDS)_. Это концепция, при которой управление хранилищем отделено от физического оборудования и реализуется программно. SDS позволяет создавать виртуальные хранилища поверх обычных серверов с дисками, управляя ими централизованно.

По определению, “*Storage virtualization is a technique that abstracts physical storage resources into a virtualized pool, streamlining management and provisioning*” [^4]. То есть виртуализация хранения упрощает управление дисковыми ресурсами, позволяя быстро выделять, изменять и масштабировать хранилища по запросу. Это повышает гибкость: администратор может добавлять новые физические диски в общий пул на ходу, и сразу увеличивается доступный объём для всех. Или, наоборот, можно разбивать один большой пул на многие тома для разных пользователей, не думая о конкретных коробках.

Представьте большой склад, заставленный коробками. Без виртуализации вам бы пришлось помнить, в какой конкретно коробке лежит ваш предмет. С виртуализацией приходит кладовщик с компьютерной системой, который говорит: “Не беспокойся, я знаю, где что лежит. Просто скажи, сколько места тебе нужно и какой скорости доступа, а я сам размещу твои вещи на полках и выдам тебе номер секции.” Для вас склад становится единым бесконечным пространством.

В облаках есть разные сервисы хранения, использующие виртуализацию:

- _Блочное хранилище_ (Block Storage). Виртуальные диски, которые можно подключать к виртуальным машинам, как обычные жёсткие диски.
- _Файловое хранилище_ (File Storage). Виртуальные файловые системы, доступные по сетевым протоколам (NFS, SMB). 
- _Объектное хранилище_ (Object Storage). Хранение данных в виде объектов с уникальными идентификаторами, доступных через API. То есть вы просто сохраняете объекты (файлы) через API, а система сама решает, на каких серверах и дисках их держать, обеспечивая масштабируемость и отказоустойчивость. Разработчик оперирует только логическими сущностями (бакеты, объекты), совсем не думая о носителях.

Виртуализация хранения предоставляет преимущества в масштабируемости и доступности данных. Например, система может автоматически перемещать часто запрашиваемые данные на SSD, а менее востребованные – на HDD или ленту, не прерывая работу приложения (*archive tiering*). Также виртуализация позволяет легко создавать резервные копии, реплики и обеспечивать *отказоустойчивость*, распределяя данные по разным физическим узлам. Для пользователя же всё выглядит как один диск. 

Резюмируя, *виртуализация сети и хранения – логичное продолжение общей идеи виртуализации в облаке*. Облако стремится предоставить каждому пользователю его собственную “виртуальную инфраструктуру” полностью – compute, storage, network – и для этого все слои должны быть абстрагированы от железа. 

- SDN позволяет гибко управлять сетями и изолировать клиентов.
- Виртуализация хранения позволяет эффективно обращаться с данными, обеспечивая высокую надёжность и масштаб.

## Контейнеры и их роль в облаке

Мы рассмотрели виртуальные машины, но в последние годы в облачных системах огромную популярность получили *контейнеры*.



[^1]: _What's the difference between cloud and virtualization?_. redhat.com [online]. Available at: https://www.redhat.com/en/topics/cloud-computing/cloud-vs-virtualization [Accessed 15.05.2025]
[^2]: _What is Software Defined Networking (SDN)?_. geeksforgeeks.org [online]. Available at: https://www.geeksforgeeks.org/computer-networks/software-defined-networking/ [Accessed 15.05.2025]
[^3]: _What is SDN?_. ibm.com [online]. Available at: https://www.ibm.com/think/topics/sdn [Accessed 15.05.2025]
[^4]: _Storage Virtualization in Cloud Computing_. knowledgehut.com [online]. Available at: https://www.knowledgehut.com/blog/cloud-computing/storage-virtualization [Accessed 15.05.2025]