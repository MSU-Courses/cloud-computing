# Введение в AWS. Глобальная инфраструктура AWS

## Почему мы изучаем AWS и как он связан с курсом Cloud Computing?

Вы помните, что в лекции по введению в облачные вычисления мы обсуждали, что такое облачные вычисления и какие у них характеристики. Мы также упомянули, что облачные вычисления предоставляют доступ к вычислительным ресурсам по требованию через интернет с оплатой по мере использования. AWS - это крупнейший и наиболее широко используемый облачный провайдер в мире, предлагающий широкий спектр услуг, которые позволяют организациям быстро и эффективно развертывать и управлять своими приложениями и инфраструктурой, не инвестируя в физическое оборудование.

## Обзор платформы AWS

*Amazon Web Services (AWS)* – это крупнейшая облачная платформа, предлагающая более 200 различных сервисов для вычислений, хранения данных, сетей, баз данных и многого другого, доступных из дата-центров по всему миру [^1]. Идея облака AWS состоит в том, что разработчики, компании и организации могут использовать готовую ИТ-инфраструктуру по запросу (on-demand), оплачивая только потребленные ресурсы (модель pay-as-you-go) вместо того, чтобы закупать и содержать собственные серверы и оборудование. Миллионы клиентов – от стартапов до правительственных учреждений – используют AWS, чтобы снизить затраты, быстрее внедрять инновации и легко масштабировать свои приложения [^2].

Главные преимущества облачной платформы AWS:

- _Гибкость и масштабируемость_. Вы можете запустить сотни серверов за минуты и так же быстро их остановить, адаптируясь под нагрузку.
- _Экономия_. Отсутствуют капитальные затраты на оборудование: вы платите только за ресурсы, которые действительно использовали (например, за часы работы виртуальной машины или объём хранилища).
- _Богатый выбор сервисов_. AWS предоставляет самый широкий набор функций среди облачных провайдеров, включая базовые инфраструктурные сервисы (серверы, хранилища, базы данных) и передовые технологии (машинное обучение, IoT, аналитика и др.).
- _Глобальная доступность и надежность_. Инфраструктура AWS распределена по всему миру, что позволяет размещать приложения ближе к пользователям и добиваться высокой отказоустойчивости.

### Основные категории сервисов AWS

AWS охватывает практически все области ИТ и включает сервисы в различных категориях. Ниже перечислены основные категории AWS с примерами сервисов [^2]:

| Категория | Описание | Примеры сервисов |
|-----------|----------|------------------|
| *Compute* (Вычисления) | Сервисы для запуска приложений и обработки данных. Они позволяют запускать ваш код или виртуальные машины в облаке. | Compute (Вычисления): Сервисы для запуска приложений и обработки данных. Примеры: *Amazon EC2* (аренда виртуальных серверов), *AWS Lambda* (безсерверное выполнение кода), *Amazon ECS/EKS* (управление контейнерами) | 
| *Storage* (Хранение данных) | Сервисы для хранения файлов, резервных копий и данных. Они обеспечивают надежное хранение больших объемов данных с возможностью масштабирования. | *Amazon S3* (объектное хранилище для файлов), *Amazon EBS* (блочное хранилище для дисков EC2), *Amazon EFS*     (сетевое файловое хранилище) |
| *Database* (Базы данных) | Управляемые баз данных под различные задачи. | *Amazon RDS* (реляционные базы данных, поддержка MySQL, PostgreSQL, Oracle и др.), *Amazon DynamoDB* (NoSQL база данных ключ-значение), *Amazon Aurora* (высокопроизводительная реляционная БД от AWS) |
| *Networking & Content Delivery* (Сети и доставка контента) | Сервисы для построения изолированных сетей, маршрутизации трафика и ускорения доставки данных. Сеть AWS позволяет безопасно соединять компоненты вашей системы и обеспечивать минимальные задержки для пользователей. | *Amazon VPC* (виртуальная облачная сеть для ваших ресурсов), *Elastic Load Balancing* (распределение нагрузки между серверами), *Amazon Route 53* (глобальная DNS-служба), *Amazon CloudFront* (глобальная CDN для кеширования и быстрой доставки контента) |
| *Security & Identity* (Безопасность и идентификация) | Сервисы для управления доступом и защиты ресурсов. | *AWS IAM* (управление учетными записями и правами доступа пользователей), *AWS KMS* (управление ключами шифрования), *AWS Shield* (защита от DDoS) |
| *Analytics, ML, IoT и прочие* | AWS предлагает и специализированные сервисы для больших данных и аналитики, машинного обучения, интернета вещей и других передовых технологий. | *Amazon Redshift* (хранилище данных для аналитики), *AWS Glue* (ETL-сервис для подготовки данных), *Amazon SageMaker* (платформа для разработки и развертывания моделей машинного обучения), *AWS IoT Core* (платформа для подключения и управления устройствами IoT) |

Обилие сервисов AWS позволяет построить практически любую ИТ-систему в облаке.

## Глобальная инфраструктура AWS. Регионы и зоны доступности

### Структура глобальной инфраструктуры AWS

AWS располагает своей инфраструктурой по всему миру, разделяя ее на *регионы* и *зоны доступности*. Этот принцип глобальной архитектуры лежит в основе высокой надежности и гибкости AWS.

*AWS регион* – это физический географический регион мира (например, Восточное побережье США, Европа (Франкфурт), Азия (Сингапур)), в котором AWS располагает несколько изолированных объектов дата-центров. В каждом регионе развёрнуто по нескольку дата-центров, объединённых в отдельные *зоны доступности* (Availability Zones, AZ).

*Зона доступности* – это один или несколько независимых дата-центров внутри региона, с собственным резервным питанием, охлаждением и сетевой инфраструктурой, расположенные отдельно друг от друга. Все зоны в регионе соединены между собой высокоскоростными и дублированными каналами связи с минимальной задержкой [^4].

Ключевые свойства такой архитектуры:


- *Изоляция отказов*. Каждая зона доступности автономна – сбой в одном дата-центре (например, отключение электричества или проблема с сетью) не затрагивает другие зоны. Это позволяет строить отказоустойчивые приложения, развернув ресурсы в нескольких зонах одного региона. Например, база данных может реплицироваться на несколько AZ, чтобы пережить выход из строя одной из них.
- *Низкие задержки внутри региона*. Зоны близки географически (обычно в пределах ~100 км) и связаны быстрыми каналами, поэтому взаимодействие ресурсов внутри одного региона происходит с минимальными задержками (обычно единицы миллисекунд).
- *Независимость регионов*. Каждый регион AWS изолирован от других – ресурсы по умолчанию не реплицируются между регионами, что обеспечивает географическую независимость и повышенную устойчивость в масштабах всего мира. Сбой в одном регионе, хотя крайне маловероятен, не влияет на работу других регионов.

На 2025 год облако AWS охватывает более 37 регионов и 117+ зон доступности по всему миру (и продолжает быстро расширяться). Каждый регион имеет как минимум три зоны доступности, и AWS регулярно анонсирует запуск новых регионов в разных странах для приближения к клиентам.

![Рисунок 1. Карта глобальной инфраструктуры AWS с указанием регионов и зон доступности](../_images/03/01_aws_regions_and_az.png)

_Рисунок 1. Карта глобальной инфраструктуры AWS с указанием регионов и зон доступности_

Разработчики при развертывании приложения в AWS выбирают регион, в котором будут созданы их ресурсы. От выбора региона зависят:

- _Близость к пользователям_. Чтобы снизить сетевые задержки и обеспечить быстрый отклик приложения, обычно выбирают регион, наиболее близкий географически к конечным пользователям или к корпоративному дата-центру. Чем ближе сервер к пользователю, тем меньше времени занимают сетевые запросы. Например, для аудитории в Европе логично выбрать европейский регион (*например*, eu-central-1 во Франкфурте).
- _Соответствие законодательству и требованиям_. Данные иногда должны храниться в определенной стране или регионе из-за требований законодательства о суверенитете данных (например, GDPR в ЕС). AWS предоставляет выбор региона для соответствия таким требованиям – данные не покидают выбранный регион без явной необходимости.
- _Стоимость и доступность сервисов_. Цены AWS немного варьируются между регионами – некоторые регионы могут быть дешевле в эксплуатации, чем другие. Кроме того, не все новые сервисы сразу доступны во всех регионах: крупные, давно открытые регионы часто первыми получают новые сервисы и функции. Поэтому при планировании инфраструктуры стоит проверить, есть ли нужные сервисы в предполагаемом регионе.

### Архитектура с несколькими регионами

Хотя внутри региона вы уже можете достичь высокой надежности с помощью множественных AZ, для критичных приложений иногда реализуют *Multi-Region архитектуру*.

*Multi-Region архитектура* подразумевает использование ресурсов в нескольких географически разнесенных регионах AWS. Это защищает от катастрофического сбоя всего региона (например, стихийное бедствие). *Multi-Region* позволяет также обслуживать пользователей, разнесенных по разным континентам, из ближайших к ним регионов, сокращая задержки. Однако мульти-региональная архитектура увеличивает сложность: требует синхронизации данных между регионами и учитывания стоимости межрегионального трафика (передача данных между регионами платная) [^5].

Например, компания может держать основной сервер в регионе Восток США и резервный в регионе Запад США: в случае проблем в одном регионе DNS автоматически переключит пользователей на резервный регион (это стратегия *Disaster Recovery*). Другой пример - глобальное приложение (например, онлайн-игра) может обслуживать европейских пользователей из европейского региона, а азиатских – из азиатского, сохраняя данные в обоих (с репликацией) для локально быстрых чтений.

## Глобальные vs. региональные сервисы AWS

Большинство сервисов AWS привязаны к конкретному региону, однако некоторые работают глобально. В AWS важно понимать разницу между *региональными сервисами* и *глобальными сервисами*.

*Региональный сервис* – ресурс этого сервиса создается в определенном регионе и обычно изолирован в его пределах. Примеры: виртуальные машины, базы данных, хранилища. Все данные сервисы создаются в конкретном регионе (например, EC2 instance в `us-east-1`) и находятся именно там. Если вам нужен аналогичный ресурс в другом регионе, его надо развернуть отдельно.

*Глобальный сервис* - сервис, охватывающий сразу все регионы или использующий глобальную распределенную инфраструктуру AWS. Для таких сервисов обычно нет привязки к конкретному региону при настройке (или есть одна глобальная конфигурация на аккаунт). *Примеры*: AWS Identity and Access Management (IAM) - управляет пользователями и правами во всем аккаунте AWS.

Чтоб вам было легче ориентироваться, есть признаки данных типов сервисов.

_Признаки глобального сервиса_: 

1. Отсутствует выбор региона в консоли для данного сервиса.
2. Ресурсы сервиса доступны из любых регионов. 
3. Часто глобальные сервисы относятся *к управлению или облегчению работы распределенных систем*.

_Признаки регионального сервиса_:

1. Требуется выбрать регион при создании ресурса, и ресурс имеет привязку к этому региону.
2. Поведение сервиса изолировано в рамках региона.  

При работе в AWS вы обычно выбираете регион в верхнем правом углу консоли AWS. Если сервис глобальный, консоль может сообщить, что выбран определенный регион, но сервис все равно действует глобально. Например, IAM в консоли отображается с меткой *«Global»* – у него нет привязки к региону.

![Рисунок 2. Пример глобального сервиса AWS (IAM) в консоли](../_images/03/02_aws_global_region.png)

_Рисунок 2. Пример глобального сервиса AWS (IAM) в консоли_

Знание различий помогает планировать архитектуру: например, если вы создаете пользователей IAM, они сразу действуют во всех регионах вашего аккаунта. А вот запущенная в одном регионе EC2 виртуальная машина не может «переехать» в другой регион без специального копирования образов или миграции. Также учет региональности важен в расчетах стоимости: трафик внутри региона зачастую дешевле (или бесплатен) по сравнению с трафиком между регионами.

## AWS аккаунты и изоляция ресурсов

*AWS аккаунт* – это *логическая изолированная* единица в AWS, предоставляющая грань безопасности и разграничения ресурсов. Можно думать об аккаунте AWS как о полном «контейнере» для ваших облачных ресурсов: все ресурсы (виртуальные машины, базы, и проч.) существуют внутри какого-то аккаунта и изолированы от ресурсов в других аккаунтах, если не настроен специальный общий доступ.

Когда вы регистрируете новый аккаунт AWS, для вас создается отдельное пространство: по умолчанию ни один другой клиент AWS (другой аккаунт) не имеет доступа к вашим ресурсам, и наоборот. Такое разделение гарантирует высокую степень безопасности и контроля. *AWS аккаунты образуют жёсткую границу безопасности* – это рекомендованный AWS подход к изоляции разных проектов и сред (production, testing, development) друг от друга.

Организации могут иметь множество AWS аккаунтов. Для управления несколькими аккаунтами AWS предоставляет сервис *AWS Organizations*, позволяющий объединить аккаунты в иерархию, централизованно управлять политиками (например, накладывать ограничения на уровне всей организации) и включать сквозной биллинг. С помощью Organizations можно, например, создать отдельные аккаунты для каждой команды (или каждого продукта) и применять общие правила безопасности ко всем через Service Control Policies (SCP).

*Пример*: Представьте компанию с несколькими продуктами: веб-сайт и мобильное приложение. Чтобы обеспечить изоляцию, компания создает два AWS аккаунта – один для инфраструктуры веб-сайта, другой для бэкенда мобильного приложения. Даже если разработчики мобильного приложения сделают ошибку в настройках, это не даст им доступа к серверам веб-сайта, так как они в другом аккаунте. Более того, затраты считаются раздельно, что облегчает расчёт бюджета по продуктам.

Можно также использовать аккаунты для разделения сред разработки. Например, аккаунт A – для разработки и тестирования, аккаунт B – для боевого окружения (production). В тестовом аккаунте разработчики свободно экспериментируют, зная, что даже если что-то пойдет не так, продакшн не затронут.

## Управление пользователями и доступом. Использование сервиса IAM

Управление доступом и безопасностью – ключевой аспект работы с AWS. 

Первый сервис, с которым вы столкнетесь в AWS, – это *AWS Identity and Access Management (IAM)*. Это глобальный сервис управления идентификацией и доступом. IAM позволяет безопасно управлять учетными записями пользователей, их правами (разрешениями) и аутентификацией в вашем аккаунте AWS.

### IAM-пользователь

*IAM-пользователь* (IAM user) - учетная запись в вашем AWS-аккаунте, которая представляет отдельного  человека или приложение. Это как создаваемая вами учетная запись внутри AWS для сотрудника или сервиса. У каждого IAM-пользователя есть свои учетные данные: пароль для входа в веб-консоль и/или ключи доступа для программного взаимодействия с AWS через API.

По умолчанию новый IAM-пользователь не имеет никаких прав, кроме как самому менять свой пароль – все остальное ему должно быть явно разрешено политиками. Обычно IAM-пользователей заводят для сотрудников, которым нужен доступ к облаку, или для приложений, которым нужно взаимодействовать с ресурсами AWS.

### IAM-группы

*IAM-группа* (IAM groups) - логическое объединение нескольких IAM-пользователей. Группа упрощает управление правами: вы прикрепляете политики (права) к группе, и все пользователи в этой группе наследуют эти права. 

Например, можно создать группу *Developers* с доступом к определенным ресурсам, и добавить туда всех разработчиков – вместо назначения прав каждому разработчику вручную. Пользователь может состоять в нескольких группах.


### IAM-роли

*IAM-роли* (IAM roles) - особый тип идентичности в IAM, не привязанный к конкретному пользователю. Роль содержит набор прав, которые могут быть временно “примерены” каким-то субъектом (пользователем или сервисом) для выполнения определенных действий.  


Роли обычно используются в двух сценариях:

- *Для сервисов AWS*. Например, вы запускаете виртуальную машину и хотите дать ему права читать из хранилища. Вместо создания IAM-пользователя и хранения ключей на сервере, вы создаете IAM-роль с нужными правами и назначаете эту роль виртуальной машине. Под капотом, виртуальная машина, получит временные креденшиалы и будет обращаться к хранилищу с правами этой роли.
- *Для межаккаунтного доступа и федерации*. Роли позволяют одному аккаунту доверять пользователям другого аккаунта временно. Пользователь может принять роль из другого аккаунта, получив временный доступ.

### Политики IAM

_Политика (Policy)_ - документ, который определяет, *какие действия разрешены или запрещены* и на каких ресурсах. Например, "пользователю X разрешено запускать и останавливать виртуальные машины". Политики в IAM обычно записываются в формате JSON и содержат описание: кто (какая идентичность или ресурс) может совершать какие действия над какими ресурсами, при каких условиях.

Политики бывают нескольких видов:

- _identity-based_. Прикрепляются к пользователю, группе или роли и дают им права. 
- _resource-based_. Прикрепляются к ресурсу.

В большинстве случаев вы будете иметь дело с identity-based политиками IAM, назначая их пользователям/группам/ролям [^7]. Например, есть готовая политика *AdministratorAccess* – дает полный доступ ко всем ресурсам AWS, её можно прикрепить IAM-пользователю (или роли), и он станет администратором. 

Если пользователь имеет прикрепленную политику, которая разрешает действие, то при обращении в AWS API это действие будет выполнено, иначе будет отказ (если только другое правило не разрешает). *По умолчанию всё запрещено*, кроме явно разрешенного. Политики – мощный инструмент для принципа наименьших привилегий: *давайте пользователям только необходимые минимальные права*.

### Корневой пользователь (root user)

При создании AWS-аккаунта вы указываете email и пароль – это создает учетную запись владельца аккаунта, называемую *root user* (корневой пользователь). *Root-пользователь* привязан к самому аккаунту AWS и обладает неограниченными правами на все ресурсы в аккаунте по умолчанию. Это *самая привилегированная учетная запись, которую рекомендуется использовать только для самых важных действий настройки* (например, привязка банковской карты, изменение платежных настроек, первоначальная настройка безопасности).

В повседневной работе *небезопасно входить под root*: лучше создать отдельного IAM-пользователя с администраторскими правами и выполнять задачи от его имени. Root же хранить в безопасности (включить MFA, сложный пароль).

_Пример использования IAM_. Допустим, у вас в команде 3 разработчика. Вы создаете IAM-пользователей: *alice*, *bob*, *carol*. Вы: 

1. Создаете IAM-группу *Developers* и даете ей политику, разрешающую управление определенным набором ресурсов. 
2. Добавляете всех трех пользователей в группу *Developers*.

Все пользователи теперь имеют одинаковые права, определенные группой. Если придет новый разработчик, вы просто заводите для него IAM-пользователя и добавляете в группу – он автоматически получит те же доступы.

## Основы биллинга AWS. Free Tier и модели оплаты

Понимание принципов оплаты в AWS поможет избежать неожиданных счетов и оптимизировать расходы. Модели ценообразования AWS отличаются от традиционного хостинга – они гибкие и зависят от потребления. Во время работы с AWS, как разработчики, скорее всего вы не будете заниматься детальным расчетом стоимости, но важно знать основы.

### AWS Free Tier. Бесплатный уровень 

*AWS Free Tier* – это программа AWS, позволяющая новым клиентам попробовать облачные сервисы бесплатно в течение ограниченного времени или объема использования. На 2025 год условия Free Tier обновились: все новые аккаунты AWS получают бонус $100 кредитов при регистрации + до $100 дополнительно за активное освоение ключевых сервисов.

Free Tier предоставляет несколько категорий бесплатного использования:

- _Кредиты $200_. При регистрации нового аккаунта вы получаете $100 кредитов на использование любых сервисов AWS в течение первых 30 дней + до $100 дополнительно за активное освоение ключевых сервисов. Эти кредиты действуют до 6 месяцев.
- _Всегда бесплатно (Always Free)_. Некоторые сервисы имеют бесплатный уровень, который действует постоянно, даже после окончания первых 6 месяцев. Например, 1 миллион запросов в месяц на AWS Lambda или 5 ГБ хранилища в Amazon S3.
- _Краткосрочные пробные периоды_. Некоторые сервисы предлагают бесплатный пробный период на 30 или 60 дней с определенными лимитами.

> Через 6 месяцев новый аккаунт переводится на Paid Plan, то есть бесплатные кредиты уже не предоставляются.

### On-Demand. Модель оплаты по требованию

*On-Demand* – основная модель оплаты AWS. Это значит, что вы оплачиваете ресурсы *помесячно, почасово или даже посекундно* в зависимости от фактического использования, без долгосрочных обязательств.

On-Demand цены тарифицируются по-разному для разных сервисов, но общий принцип: нет предоплаты, нет минимального срока – *вы можете в любой момент отключить ресурс и перестать платить за него*.

Однако за гибкость On-Demand приходится платить более высокой ставкой в длительной перспективе. Если вы знаете, что будете пользоваться ресурсом постоянно, AWS предлагает способы сэкономить, используя модель *Reserved Instances*.

### Reserved Instances. Резервирование с предоплатой

*Reserved Instances* – модель, при которой вы бронируете ресурс на длительный срок (1 или 3 года) и взамен получаете значительную скидку (до 72%).

Как это работает Reserved Instances:

- Вы решаете, что вам нужен определенный ресурс (например, виртуальная машина) на длительный срок. Вместо оплаты On-Demand каждый час, вы можете купить Reserved Instance на 1 год для этого региона.
- При покупке вы можете выбрать опцию оплаты:
  - _Оплата всего сразу_ (All Upfront). Платите всю сумму сразу и получаете максимальную скидку.
  - _Частичная предоплата_ (Partial Upfront). Платите часть суммы сразу, остальное – помесячно.
  - _Без предоплаты_ (No Upfront). Платите помесячно, но с меньшей скидкой. Берете на себя обязательство.
- После покупки вы получаете скидку на использование этого ресурса в течение срока бронирования. Если вы используете ресурс меньше, чем зарезервировали, вы все равно платите за него.


В последнее время AWS также предлагает *Savings Plans* – более гибкую альтернативу Reserved Instances, позволяющую экономить на широком спектре ресурсов при обязательстве по ежемесячным расходам. Вы просто обязуетесь тратить `N долларов в час` на определенные ресурсы, и получаете скидку, при этом более гибко можете менять типы ресурсов. Тем не менее, идея та же: *длительное обязательство в обмен на скидку*.

> Reserved Instances и Savings Plans работают только для определенных сервисов (например, EC2, RDS) и не покрывают все ресурсы AWS.


### Spot Instances. Вычислительные ресурсы по сниженной цене

*Spot Instances* – это модель, позволяющая использовать неиспользуемые вычислительные ресурсы AWS по значительно сниженной цене (до 90% дешевле On-Demand), *но без гарантии непрерывной работы*. Такой ресурс может быть забран обратно, когда он понадобится другим клиентам (On-Demand или Reserved).

AWS может остановить ваш Spot-инстанс в любой момент, когда потребуется ресурсы для обычных покупателей. Вам дается уведомление за 2 минуты до завершения инстанса.

Spot Instances идеально подходят для задач, которые могут быть прерваны и возобновлены без потери данных, например:

- Обработка больших данных (batch processing)
- Аналитика
- Тестирование и разработка


[^1]: _Overview of Amazon Web Services_. docs.aws.amazon.com [online]. Available at: https://docs.aws.amazon.com/whitepapers/latest/aws-overview/introduction.html
[^2]: _Cloud computing with AWS_. aws.amazon.com [online]. Available at: https://aws.amazon.com/what-is-aws/
[^3]: _AWS Infrastructure Offerings_. aws.amazon.com [online]. Available at: https://aws.amazon.com/about-aws/global-infrastructure/regions_az/
[^4]: _Global infrastructure_. docs.aws.amazon.com [online]. Available at: https://docs.aws.amazon.com/whitepapers/latest/aws-overview/global-infrastructure.html
[^5]: _What to Consider when Selecting a Region for your Workloads_. aws.amazon.com [online]. Available at: https://aws.amazon.com/blogs/architecture/what-to-consider-when-selecting-a-region-for-your-workloads/
[^6]: _IAM Identities_. docs.aws.amazon.com [online]. Available at: https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html
[^7]: _Policies and permissions in AWS Identity and Access Management_. docs.aws.amazon.com [online]. Available at: https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html