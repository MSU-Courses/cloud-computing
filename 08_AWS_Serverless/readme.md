# Безсерверные вычисления. AWS Lambda

## Вопросы для самопроверки

1. После изучения данной лекции студент должен уметь ответить на следующие вопросы:
2. Чем отличается концепция serverless от традиционной серверной архитектуры и в каких случаях целесообразно использовать каждый подход?
3. Как работает событийно-ориентированная модель AWS Lambda и какие источники событий могут запускать выполнение функций?
4. Каковы основные ограничения AWS Lambda и как они влияют на проектирование приложений?
5. Как правильно конфигурировать Lambda-функцию, включая настройку памяти, времени выполнения и роли выполнения?

## Введение в Serverless Computing

### Традиционный подход к разработке приложений

Когда мы разрабатываем веб-приложение традиционным способом, нам необходимо заботиться не только о самом коде приложения, но и об инфраструктуре, на которой оно будет работать. Представьте, что вы открываете ресторан: _вам нужно не только готовить еду, но и арендовать помещение_, покупать оборудование, следить за его состоянием, оплачивать электричество и воду - даже когда ресторан закрыт и посетителей нет.

Аналогично, в традиционной архитектуре разработчики должны [^1]:

- Выбирать и настраивать серверы (физические или виртуальные).
- Устанавливать и обновлять операционную систему.
- Настраивать сетевую инфраструктуру.
- Масштабировать серверы при увеличении нагрузки.
- Обеспечивать безопасность и резервное копирование.
- Оплачивать серверы круглосуточно, независимо от фактической нагрузки.

### Концепция Serverless Computing

_Serverless computing_ (безсерверные вычисления) - это модель облачных вычислений, при которой провайдер облачных услуг автоматически управляет инфраструктурой, необходимой для выполнения кода. Важно понимать, что название "serverless" несколько вводит в заблуждение - серверы все еще существуют, просто разработчику не нужно о них беспокоиться [^2] [^3].

Возвращаясь к аналогии с рестораном: вместо того чтобы открывать собственное заведение, вы становитесь шеф-поваром, который готовит блюда только когда приходит заказ. Всю инфраструктуру - кухню, оборудование, уборку, коммунальные платежи - берет на себя кто-то другой. Вы платите только за время, которое потратили на приготовление блюд.

Не нужно путать Serverless Computing с

### Основные характеристики концепции Serverless

Serverless computing обладает рядом ключевых характеристик, которые отличают его от традиционных подходов:

- _Событийно-ориентированная модель_. Код выполняется только в ответ на определенные события - HTTP-запрос, загрузка файла, изменение в базе данных. Между событиями ваш код не потребляет ресурсы.
- _Автоматическое масштабирование_. Если одновременно приходит одно событие или тысяча, платформа автоматически выделяет необходимое количество ресурсов для их обработки.
- _Оплата за фактическое использование_. Вы платите только за время выполнения кода, измеряемое в миллисекундах, а не за время, когда сервер простаивает.
- _Отсутствие управления серверами_. Провайдер полностью берет на себя обслуживание, масштабирование, обновление и обеспечение отказоустойчивости инфраструктуры.
- _Stateless-выполнение_. Каждый вызов функции является независимым и _не сохраняет состояние между вызовами_. Если нужно сохранить данные, используются внешние сервисы хранения.

### Serverless vs Server: ключевые различия

Сравним детально традиционный серверный подход и безсерверные вычисления [^4]:

| Характеристика             | Традиционная (Server)                                       | Serverless                                    |
| -------------------------- | ----------------------------------------------------------- | --------------------------------------------- |
| Управление инфраструктурой | Разработчик настраивает и управляет серверами               | Провайдер полностью управляет инфраструктурой |
| Масштабирование            | Требуется ручная настройка или предварительная конфигурация | Автоматическое, мгновенное                    |
| Модель оплаты              | Оплата за зарезервированные мощности (24/7)                 | Оплата только за время выполнения кода        |
| Время простоя              | Серверы работают постоянно, даже без нагрузки               | Ресурсы выделяются только при необходимости   |
| Холодный старт             | Отсутствует (сервер всегда готов)                           | Возможна задержка при первом запросе          |
| Гибкость конфигурации      | Полный контроль над окружением                              | Ограниченные возможности настройки            |

### Преимущества и недостатки Serverless Computing

Безсерверные вычисления предлагают множество преимуществ, но также имеют и свои ограничения. Рассмотрим основные из них:

| Преимущества                                                                                                                                                                                    | Недостатки                                                                                                                                                                                                                                          |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| _Повышение производительности разработчиков_. Освобожденные от задач администрирования серверов, разработчики могут сосредоточиться на написании бизнес-логики и создании функциональности      | _Проблема холодного старта_. При первом вызове функции после периода простоя требуется время на инициализацию окружения, что может составлять от 100 миллисекунд до нескольких секунд. Это критично для приложений, требующих минимальных задержек. |
| _Сокращение операционных расходов_. Отсутствие необходимости оплачивать простаивающие серверы значительно снижает затраты, особенно для приложений с нерегулярной или непредсказуемой нагрузкой | _Vendor lock-in_. Переход на другого провайдера может потребовать значительной переработки кода из-за использования специфичных API и сервисов                                                                                                      |
| _Быстрый вывод на рынок_. Упрощенный процесс развертывания позволяет быстрее внедрять новые функции и исправлять ошибки.                                                                        | _Ограниченная кастомизация_. Вы не можете полностью контролировать окружение выполнения - доступны только те опции, которые предоставляет платформа.                                                                                                |
| _Встроенная отказоустойчивость_. Облачные провайдеры обеспечивают высокую доступность и автоматическое восстановление после сбоев.                                                              | _Сложность отладки и мониторинга_. Распределенная природа serverless-приложений усложняет отслеживание ошибок и анализ производительности                                                                                                           |
| _Автоматическая масштабируемость_. Приложение может обрабатывать как единичные запросы, так и миллионы одновременных событий без ручной настройки.                                              | _Ограничения времени выполнения_. Serverless-функции обычно имеют максимальное время выполнения (например, 15 минут в AWS Lambda), что делает их непригодными для длительных задач.                                                                 |

> Serverless не заменяет традиционные архитектуры полностью. Многие организации используют гибридный подход, комбинируя serverless для определенных задач с традиционными серверами для других компонентов системы [^5]s

## AWS Lambda: введение и основные концепции

### Что такое AWS Lambda?

_AWS Lambda_ - это полностью управляемый сервис безсерверных вычислений от Amazon Web Services, который _позволяет запускать код без необходимости создания и управления серверами_. Lambda была представлена в 2014 году и стала пионером в области Function-as-a-Service (FaaS) [^5].

Простыми словами, AWS Lambda позволяет загружать свой код, написанный на разных языках программирования, и выполнять его автоматически — когда происходит определённое событие или в заданное время, _не заботясь о серверной инфраструктуре_.

Lambda часто называют _функциями_, потому что здесь вы создаёте небольшие, независимые участки кода, каждый из которых выполняет одну конкретную задачу. Когда происходит нужное событие, эта функция запускается, выполняет свою работу и завершает выполнение. После этого ресурсы автоматически освобождаются, поэтому вам не нужно постоянно поддерживать работающий сервер.

AWS Lambda автоматически масштабируется для обработки от нескольких запросов в день до тысяч запросов в секунду. Вы загружаете свой код, а Lambda берет на себя все необходимое для его выполнения и масштабирования с высокой доступностью [^5].

### Назначение AWS Lambda

Lambda предназначена для решения широкого спектра задач:

- _Обработка данных в реальном времени_. Анализ потоковых данных, обработка логов, мониторинг метрик.
- _Обработка файлов_. Автоматическое создание миниатюр изображений, конвертация видео, обработка документов при загрузке в S3.
- _Бэкенд для веб и мобильных приложений_. Обработка API-запросов, аутентификация пользователей, интеграция с базами данных.
- _Пакетная обработка данных_. Генерация отчетов, агрегация данных.
- _Автоматизация инфраструктуры_. Автоматический запуск и остановка EC2 инстансов по расписанию, резервное копирование, управление ресурсами.
- _IoT-приложения_. Обработка событий от IoT-устройств, маршрутизация сообщений, реагирование на изменения состояния.

Таким образом, Lambda используется для выполнения кода в ответ на события, особенно когда задачи не требуют длительных вычислений и не потребляют много ресурсов.

### Масштабируемость AWS Lambda

_AWS Lambda_ является _региональным сервисом_, что означает, что функции создаются и хранятся в конкретном AWS-регионе. Понимание этой архитектуры важно для проектирования отказоустойчивых и производительных приложений [^6].

Когда вы создаете Lambda-функцию, вы выбираете регион, в котором она будет размещена. _Код функции, конфигурация и логи хранятся в этом регионе_. AWS автоматически реплицирует вашу функцию в нескольких зонах доступности (Availability Zones) внутри выбранного региона для обеспечения высокой доступности. Это значит, что даже если одна зона доступности выйдет из строя, ваша функция останется доступной через другие зоны.

Что это означает на практике:

- _Низкая задержка_. Размещайте Lambda-функции в том же регионе, где находятся ресурсы, с которыми они взаимодействуют (S3, DynamoDB, RDS и т.д.), чтобы минимизировать задержки при вызовах.
- _Соответствие требованиям_. Некоторые законодательства требуют, чтобы данные оставались в определенной географической зоне.
- _Отказоустойчивость_. Lambda автоматически распределяет нагрузку между зонами доступности в регионе.
- _Стоимость_. Передача данных между регионами тарифицируется, поэтому размещение в одном регионе экономически выгоднее.

> По умолчанию есть ограничение в _1000 одновременных выполнений Lambda-функций_ на регион. Это мягкое ограничение, которое можно увеличить, обратившись в AWS Support, если ваше приложение требует большего масштаба.

### Событийно-ориентированная модель AWS Lambda

Ключевая особенность Lambda заключается в том, что _функции запускаются только при наличии триггера_ - определенного события. Это отличает Lambda от традиционных серверов, которые работают постоянно в ожидании запросов.

Представьте датчик движения, который включает свет только когда кто-то проходит мимо. Lambda работает аналогично: _ваш код "спит" и не потребляет ресурсы до тех пор, пока не произойдет событие, которое его активирует_.

Такой подход имеет несколько важных последствий:

- _Экономия ресурсов_. Нет необходимости держать серверы запущенными в ожидании запросов.
- _Автоматическое масштабирование_. Lambda автоматически создает столько экземпляров функции, сколько необходимо для обработки входящих событий.
- _Изоляция_. Каждый вызов функции обрабатывается независимо, что повышает надежность системы.

### AWS Lambda, как функция

В контексте AWS Lambda _функция_ - это базовая единица развертывания и выполнения. Это фрагмент кода, который выполняет конкретную задачу в ответ на событие.

Важно понимать различие между функцией как концепцией программирования и Lambda-функцией:

- _Функция в программировании_ - это блок кода, который может быть вызван из других частей программы.
- _Lambda-функция_ - это полноценное приложение, включающее код, зависимости, конфигурацию и права доступа.

Каждая _Lambda-функция_ имеет:

- _Handler (обработчик)_ - точка входа, метод, который Lambda вызывает для начала выполнения вашего кода.
- _Runtime (среда выполнения)_ - языковое окружение, в котором выполняется код. Например, Node.js, Python, Java, Go и другие.
- _Execution role (роль выполнения)_ - IAM-роль, определяющая разрешения функции. Например, доступ к S3, DynamoDB и другим ресурсам AWS.
- _Configuration (конфигурация)_ - параметры памяти, времени выполнения, переменных окружения. Например, вы можете настроить функцию на использование 512 МБ памяти и максимальное время выполнения 30 секунд.

## AWS Lambda vs Amazon EC2

### Различия и сценарии использования

Когда следует использовать Lambda, а когда - традиционные EC2 инстансы? Это один из ключевых вопросов при проектировании облачных приложений. Давайте рассмотрим сравнение этих двух подходов.

| Аспект                        | AWS Lambda                           | Amazon EC2                                  |
| ----------------------------- | ------------------------------------ | ------------------------------------------- |
| Модель управления             | Полностью управляемая, без серверов  | Виртуальные серверы, требующие управления   |
| Масштабирование               | Автоматическое, мгновенное           | Требует настройки _Auto Scaling_            |
| Оплата                        | За время выполнения (миллисекунды)   | За время работы инстанса (часы)             |
| Максимальное время выполнения | 15 минут                             | Неограниченно                               |
| Состояние                     | Stateless (без сохранения состояния) | Stateful (может сохранять состояние)        |
| Холодный старт                | 100-1000 мс                          | Отсутствует (сервер всегда работает)        |
| Максимальная память           | 10,240 МБ                            | До сотен ГБ, в зависимости от типа инстанса |
| Контроль над окружением       | Ограниченный                         | Полный                                      |

Lambda является оптимальным выбором в следующих сценариях:

- _Обработка событий_. Когда задача запускается в ответ на событие - загрузку файла в S3, изменение в DynamoDB, HTTP-запрос через API Gateway.
- _Непредсказуемая или переменная нагрузка_. Lambda автоматически масштабируется от нуля до тысяч одновременных выполнений, и вы платите только за фактическое использование.
- _Короткие задачи_. Функции, выполняющиеся от миллисекунд до нескольких минут - обработка API-запросов, трансформация данных, генерация миниатюр изображений.
- _Микросервисная архитектура_. Каждый микросервис может быть реализован как отдельная Lambda-функция, что упрощает разработку и развертывание.
- _Экономия на простаивающих ресурсах_. Если ваше приложение получает запросы нерегулярно, Lambda позволяет не платить за время простоя.

_Пример из реальной жизни_: интернет-магазин получает заказы неравномерно в течение дня. В пиковые часы (вечер, выходные) количество заказов может увеличиваться в 10 раз. Lambda автоматически масштабируется для обработки всех заказов, а в периоды низкой активности вы не платите за неиспользуемые ресурсы.

В то время, как Amazon EC2 подходит для следующих случаев:

- _Длительные процессы_. Задачи, выполняющиеся более 15 минут (например, обучение моделей машинного обучения, длительные вычисления).
- _Постоянная высокая нагрузка_. Если приложение получает стабильный трафик 24/7, Reserved Instances EC2 могут быть экономически выгоднее.
- _Stateful-приложения_. Когда необходимо сохранять состояние между запросами (например, игровые серверы, сессии пользователей).
- _Требования к производительности_. Когда критична минимальная задержка и холодный старт Lambda неприемлем.
- _Полный контроль_. Когда требуется настройка операционной системы, сетевой конфигурации или специфического ПО.

### Гибридный подход

Многие современные приложения используют гибридный подход:

- _Часть функционала реализуется с помощью AWS Lambda_ - например, обработка API-запросов или событий от S3 и DynamoDB.
- _Другая часть работает на EC2_ - например, длительные фоновые процессы, базы данных или сервисы с постоянной нагрузкой.

Часто основное приложение разворачивается на EC2, а отдельные задачи выносятся в Lambda, если они выполняются нерегулярно, требуют быстрого масштабирования или хорошо подходят под безсерверную архитектуру.

_Типичный сценарий_: 

[^1]: _What is Serverless Computing? Examples, Pros & Cons, & Future Trends_. aimconsulting.com [online]. Available at: https://aimconsulting.com/insights/serverless-computing-examples-pros-cons-kubernetes-trends/
[^2]: _AWS Lambda_. aws.amazon.com [online]. Available at: https://aws.amazon.com/lambda/
[^3]: _Что такое бессерверные вычисления_. colobridge.com [online]. Available at: https://blog.colobridge.net/2024/01/serverless-computing/
[^4]: _Serverless on AWS_. aws.amazon.com [online]. Available at: https://aws.amazon.com/serverless/
[^5]: _What Is AWS Lambda? A Beginner’s Guide to Serverless in 2025_. cloudthat.com [online]. Available at: https://www.cloudthat.com/resources/blog/what-is-aws-lambda-a-beginners-guide-to-serverless-in-2025
[^6]: _Resilience in AWS Lambda_. docs.aws.amazon.com [online]. Available at: https://docs.aws.amazon.com/lambda/latest/dg/security-resilience.html
